<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>筋トレ＆ダイエットタイマー</title>
<meta name="description" content="筋トレやダイエットに最適なトレーニング＆休憩タイマー。タバタ・ダイエット・カスタムの3モード対応、運動中はBGM自動再生。">
<!-- OGP設定 -->
<meta property="og:title" content="筋トレ＆ダイエットタイマー" />
<meta property="og:description" content="筋トレやダイエットに最適なトレーニング＆休憩タイマー。タバタ・ダイエット・カスタムの3モード対応、運動中はBGM自動再生。" />
<meta property="og:image" content="https://fit.kkpwebninja.com/k2c-ogp.png" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:url" content="https://fit.kkpwebninja.com/" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />

<style>
body { font-family: sans-serif; text-align: center; background: #f4f4f4; margin: 0; padding: 0;}
h1 { background: #ff6b6b; color: white; padding: 10px; margin: 0;}
#display { font-size: 5em; margin: 20px 0;}
#phase { font-size: 1.5em; margin-bottom: 10px;}
#count { font-size: 1.2em; margin-bottom: 20px;}
button { font-size: 1.2em; padding: 10px 20px; margin: 5px; }
.controls { margin-top: 20px; }
.mode-select { margin-top: 30px; background: white; padding: 10px; }
iframe { width: 100%; max-width: 500px; height: 200px; margin-top: 20px; }
</style>
</head>
<body>

<h1>筋トレ＆ダイエットタイマー</h1>
<div id="display">00</div>
<div id="phase">待機中</div>
<div id="count">1 回目</div>

<div class="controls">
  <button id="startBtn">スタート</button>
  <button id="pauseBtn" disabled>一時停止</button>
  <button id="resetBtn" disabled>リセット</button>
</div>

<div id="player"></div>

<div class="mode-select">
  <label><input type="radio" name="mode" value="tabata" checked> タバタ（20秒運動 / 10秒休憩 ×8）</label><br>
  <label><input type="radio" name="mode" value="diet"> ダイエット（30秒運動 / 15秒休憩 ×6）</label><br>
  <label><input type="radio" name="mode" value="custom"> カスタム：
    運動 <input type="number" id="trainSec" value="20" min="5" max="600"> 秒　
    休憩 <input type="number" id="restSec" value="10" min="5" max="600"> 秒　
    セット <input type="number" id="rounds" value="8" min="1" max="50"> 回
  </label>
</div>

<script>
// モード設定
const modes = {
  tabata: {train:20, rest:10, rounds:8},
  diet:   {train:30, rest:15, rounds:6}
};

const elDisp = document.getElementById("display");
const elPhase = document.getElementById("phase");
const elCount = document.getElementById("count");
const startBtn = document.getElementById("startBtn");
const pauseBtn = document.getElementById("pauseBtn");
const resetBtn = document.getElementById("resetBtn");

let phase = "wait"; // wait/countdown/train/rest
let currentRound = 1;
let totalRounds = 8;
let trainTime = 20;
let restTime = 10;
let running = false;
let paused = false;
let rafId = null;
let lastShown = null;
let phaseEndAt = 0;

// YouTubeプレイヤー
let player;
function onYouTubeIframeAPIReady(){
  player = new YT.Player('player', {
    videoId: 'cZRENUODbvw',
    events: { 'onReady': ()=>stopVideo() }
  });
}
function startVideo(){ if(player?.playVideo) player.playVideo(); }
function stopVideo(){ if(player?.stopVideo) player.stopVideo(); }

function fmt(sec){ return sec.toString().padStart(2,'0'); }

function startPhase(newPhase, duration){
  phase = newPhase;
  phaseEndAt = performance.now() + duration * 1000;
  lastShown = null;
  if(phase === "train"){ elPhase.textContent = "トレーニング中"; startVideo(); }
  else if(phase === "rest"){ elPhase.textContent = "休憩中"; stopVideo(); }
  else if(phase === "countdown"){ elPhase.textContent = "開始まで"; stopVideo(); }
  else { elPhase.textContent = "待機中"; stopVideo(); }
}

function update(){
  if(!running) return;
  const now = performance.now();
  let remain = Math.max(0, Math.ceil((phaseEndAt - now) / 1000));
  if(remain !== lastShown){
    elDisp.textContent = fmt(remain);
    lastShown = remain;
  }
  if(remain <= 0){
    if(phase === "countdown"){ startPhase("train", trainTime); }
    else if(phase === "train"){
      if(currentRound >= totalRounds){ running=false; elPhase.textContent="終了！"; stopVideo(); return; }
      startPhase("rest", restTime);
    }
    else if(phase === "rest"){
      currentRound++;
      elCount.textContent = `${currentRound} 回目`;
      startPhase("train", trainTime);
    }
  }
  rafId = requestAnimationFrame(update);
}

startBtn.addEventListener("click", ()=>{
  const mode = document.querySelector('input[name="mode"]:checked').value;
  if(mode !== "custom"){ ({train:trainTime, rest:restTime, rounds:totalRounds} = modes[mode]); }
  else {
    trainTime = parseInt(document.getElementById("trainSec").value);
    restTime = parseInt(document.getElementById("restSec").value);
    totalRounds = parseInt(document.getElementById("rounds").value);
  }
  currentRound = 1;
  elCount.textContent = "1 回目";
  running = true; paused = false;
  startBtn.disabled = true; pauseBtn.disabled = false; resetBtn.disabled = false;
  startPhase("countdown", 3);
  update();
});

pauseBtn.addEventListener("click", ()=>{
  if(!running) return;
  paused = !paused;
  if(paused){ cancelAnimationFrame(rafId); elPhase.textContent += "（一時停止中）"; stopVideo(); }
  else { phaseEndAt = performance.now() + lastShown * 1000; update(); }
});

resetBtn.addEventListener("click", ()=>{
  running = false; paused = false;
  cancelAnimationFrame(rafId);
  elDisp.textContent = "00";
  elPhase.textContent = "待機中";
  elCount.textContent = "1 回目";
  startBtn.disabled = false; pauseBtn.disabled = true; resetBtn.disabled = true;
  stopVideo();
});
</script>
<script src="https://www.youtube.com/iframe_api"></script>

</body>
</html>
