<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>筋トレ＆ダイエットタイマー</title>

<!-- ✅ OGP設定 -->
<meta property="og:title" content="筋トレ＆ダイエットタイマー" />
<meta property="og:description" content="筋トレ・ダイエットの両方に使えるハンズフリー対応インターバルタイマー。タバタ・有酸素運動にも最適。" />
<meta property="og:image" content="https://fit.kkpwebninja.com/k2c-ogp.png" />
<meta property="og:url" content="https://fit.kkpwebninja.com/" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />

<style>
body {
  font-family: sans-serif;
  text-align: center;
  margin: 0;
  padding: 0;
}
h1 { margin: 20px 0; }
#countdown { font-size: 4em; margin: 20px 0; }
.controls, .settings { margin: 10px 0; }
label { margin: 0 5px; }
button {
  font-size: 1.2em;
  margin: 5px;
  padding: 10px 20px;
}
#video-container {
  display: none;
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background: #000;
}
body.video-open { padding-bottom: 200px; }
</style>
</head>
<body>

<h1>筋トレ＆ダイエットタイマー</h1>

<div id="countdown">準備OK?</div>

<div class="settings">
  <label><input type="radio" name="mode" value="tabata" checked> タバタ</label>
  <label><input type="radio" name="mode" value="diet"> ダイエット</label>
  <label><input type="radio" name="mode" value="custom"> カスタム</label>
</div>

<div id="custom-settings" style="display:none;">
  <label>運動秒数: <input type="number" id="workTime" value="20"></label>
  <label>休憩秒数: <input type="number" id="restTime" value="10"></label>
  <label>セット数: <input type="number" id="sets" value="8"></label>
</div>

<div class="controls">
  <button id="startBtn">スタート</button>
  <button id="pauseBtn">一時停止</button>
  <button id="resetBtn">リセット</button>
</div>

<div id="video-container">
  <iframe id="ytplayer" width="100%" height="200" frameborder="0"
    allow="autoplay; encrypted-media" allowfullscreen></iframe>
</div>

<script>
let countdownEl = document.getElementById('countdown');
let videoContainer = document.getElementById('video-container');
let player;
let timer, timeLeft, currentSet, isWork, isPaused = false;

const modes = {
  tabata: {work: 20, rest: 10, sets: 8},
  diet: {work: 30, rest: 15, sets: 6},
};

document.querySelectorAll('input[name="mode"]').forEach(r => {
  r.addEventListener('change', () => {
    if (r.value === 'custom') {
      document.getElementById('custom-settings').style.display = 'block';
    } else {
      document.getElementById('custom-settings').style.display = 'none';
    }
  });
});

document.getElementById('startBtn').addEventListener('click', startTimer);
document.getElementById('pauseBtn').addEventListener('click', pauseTimer);
document.getElementById('resetBtn').addEventListener('click', resetTimer);

function startTimer() {
  let selectedMode = document.querySelector('input[name="mode"]:checked').value;
  let workTime, restTime, sets;
  if (selectedMode === 'custom') {
    workTime = parseInt(document.getElementById('workTime').value) || 20;
    restTime = parseInt(document.getElementById('restTime').value) || 10;
    sets = parseInt(document.getElementById('sets').value) || 8;
  } else {
    workTime = modes[selectedMode].work;
    restTime = modes[selectedMode].rest;
    sets = modes[selectedMode].sets;
  }

  currentSet = 1;
  isWork = true;
  startCountdown(3, () => { // スタート前カウント
    startVideo();
    timeLeft = workTime;
    timer = setInterval(() => {
      if (!isPaused) {
        timeLeft--;
        updateDisplay();
        if (timeLeft <= 0) {
          if (isWork) {
            isWork = false;
            stopVideo();
            timeLeft = restTime;
          } else {
            currentSet++;
            if (currentSet > sets) {
              clearInterval(timer);
              countdownEl.textContent = '終了！お疲れさま！';
              stopVideo();
              return;
            }
            isWork = true;
            startVideo();
            timeLeft = workTime;
          }
        }
      }
    }, 1000);
    updateDisplay();
  });
}

function startCountdown(seconds, callback) {
  let count = seconds;
  countdownEl.textContent = count;
  let cd = setInterval(() => {
    count--;
    countdownEl.textContent = count > 0 ? count : 'スタート！';
    if (count <= 0) {
      clearInterval(cd);
      callback();
    }
  }, 1000);
}

function updateDisplay() {
  countdownEl.textContent = `${isWork ? '運動' : '休憩'}: ${timeLeft}秒 (セット${currentSet})`;
}

function pauseTimer() {
  isPaused = !isPaused;
}

function resetTimer() {
  clearInterval(timer);
  countdownEl.textContent = '準備OK?';
  isPaused = false;
  stopVideo();
}

function startVideo(){
  document.body.classList.add('video-open');
  videoContainer.style.display = 'block';
  player.playVideo();
}

function stopVideo(){
  document.body.classList.remove('video-open');
  videoContainer.style.display = 'none';
  player.pauseVideo();
}

// YouTube API
let tag = document.createElement('script');
tag.src = "https://www.youtube.com/iframe_api";
document.body.appendChild(tag);

function onYouTubeIframeAPIReady() {
  player = new YT.Player('ytplayer', {
    videoId: 'cZRENUODbvw',
    playerVars: { autoplay: 0, controls: 0 },
    events: {}
  });
}
</script>

</body>
</html>
